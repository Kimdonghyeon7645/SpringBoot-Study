# 8-1. EC2에 프로젝트 배포 후 설정

### 1. 외부 Security 파일 등록

이전에 만들었던 배포 스크립트 실행 후, ```vim nohup.out```으로 파일을 열어 로그를 보면,  
맨 아래에 *'ClientRegistrationRepository 를 찾을 수 없다'* 는 에러가 발생한 것을 볼 수 있다.  

이 이유는, *ClientRegistrationRepository*를 생성하기 위해 필요한 **clientId, clientSecret**가 없어서다.  
그 정보는 **.gitignore**로 git 제외대상에 등록한```application-oauth.properties```파일에 있다.

근데 그렇다고 공개저장소에 ```application-oauth.properties```파일을 올릴 수는 없으니, **서버로 직접 이 파일을 복사**해주자.

```shell script
vim ~/app/application-oauth.properties
```
로 step1이 아닌 app 폴더에 properties 파일을 생성한다. (app 폴더에 올린 이유는 이후 step2, step3에서도 쓰기 위해서)  
그후, 로컬에 있는 ```application-oauth.properties``` 파일 내용을 복붙에 저장(```:wq```)한다.  

그리고 방금 생성한 ```application-oauth.properties```를 쓸 수 있게, ```deploy.sh```파일을 수정한다.
```shell script
nohup java -jar $REPOSITORY/$JAR_NAME 2>&1 &  # 이 부분을
```

```shell script
nohup java -jar \
    -Dspring.config.location=classpath:/application.properties,/home/ec2-user/app/application-oauth.properties \
    $REPOSITORY/$JAR_NAME 2>&1 &    # 이렇게 수정
```

> ### -Dspring.config.location
>
> 스프링 설정 파일 위치를 지정하는데,  
> 기본옵션이 담긴 ```application-oauth.properties```의 위치와 OAuth 설정이 담긴 ```application-oauth.properties```의 위치를 지정  
> - classpath가 붙으면 jar 안에 있는 resources 디렉토리를 기준으로 경로 생성  
> - ```application-oauth.properties```은 외부에 파일이 있기에 절대 경로를 사용



# 6-1. AWS 회원가입, 인스턴스 생성

> #### AWS 회원가입
>
> 해외결제 가능한 Master, Visa 카드가 필요하다.
> (이게 없어서 못했었다 ㅠㅠ... 농협 체크카드 중에 Visa카드 있으니 참고)

### 1. EC2 인스턴스 생성

**EC2(Elastic Compute Cloud)** : 성능, 용량을 유동적으로 쓸 수 있는 AWS 제공 서버  
(AWS에서 리눅스/윈도우 서버 쓴다하면 이 EC2를 말함)

> #### EC2는 뭘 줄인 말일까
>
> Elastic Compute Cloud를 줄이면 ECC인데,  
> AWS에선 앞글자가 중복되면 숫자로 표시해 부른다. 그래서 ECC -> EC2가 됬다.   
> 비슷한 예론, 온라인 스토리지인 S3(Simple Storage Service)가 있다.

### 2. EC2 프리티어 제한

1. 사양 제한 : t2.micro 
    
     vCPU 1코어, 메모리 1GB(vCPU 성능 = CPU 성능의 절반)
2. 시간 제한 : 월 750시간(초과시 비용 생김)  
    
    '1달 = 744시간' 이라서, EC2가 1개면 1달 내내 구동 가능
    
### 3. 리전(=AWS 서비스가 구동될 지역) 확인

AWS는 도시별로 클라우드 센터를 지어 해당 센터의 가상머신들을 사용 가능(=리전)  
-> 실제 서비스될 지역과 리전이 가까울수록 빠르다.  
-> **보통 기본값이 오아이주 인데, 서울로 변경**

## 4. EC2 생성

**EC2 대시보드에서 인스턴스 시작**을 클릭하면, 아래 이미지처럼 7가지 절차가 뜬다.
![image](https://user-images.githubusercontent.com/48408417/110202569-e5cfaf00-7eac-11eb-9a37-42fe2d863925.png)  
  
1. AMI 선택

    > #### AMI(Amazon Machine Image)란
    >
    > AMI : EC2 인스턴스 시작에 필요한 정보를 이미지로 만들어 둔 것   
      (인스턴스라는 가상머신에 운영체제 등을 설치할려고 구워둔 이미지)

    책에선 국내자료가 많은 **아마존 리눅스 1 AMI**를 선택하라는데,    
    검색하니까 없다!(21년 3월 6일) -> **아마존 리눅스 2 AMI**로 간다.
    
    > #### 센토스 AMI 안쓰고 아마존 리눅스 AMI 쓰는 이유
    > 
    > - 아마존이 개발하기 때문에 지원 쉬움
    > - 레드햇 베이스 -> 써본 사람이면 쉽게 사용 가능 
    > - AWS의 서비스와 상성 좋음
    > - AWS의 독자적인 레포를 사용하기 때문에 yum이 매우 빠름

2. 인스턴스 유형 선택

    인스턴스 유형 : **t2.micro** 선택
    
    > #### 인스턴스 이름의 의미
    >
    > t2는 요금 타입, micro는 사양을 의미  
      t2, t3같은 것은 T 시리즈로, 범용 시리즈라 불리는만큼 다양한 사양을 제공
    > 
    > 이들은 다른 서비스와 달리, **크레딧**이란 CPU를 사용할 수 있는 포인트 개념이 존재  
      인스턴스 크기에 따라 정해진 비율로 CPU 크레딧을 받는데, 안쓸땐 축적하고, 쓸덴 크레딧을 사용(정해진 사양을 초과하는 트래픽에는 더 크레딧을 적극적으로 사용)  
      **크레딧을 모두 쓰면 EC2를 더이상 못 씀** (-> 트래픽 높은 서비스는 T 시리즈를 잘 안씀, 활용도가 높아 시작하는 단계에선 T 시리즈 조와용)
    
3. 세부정보 구성

    기본 설정 그대로 패스  
    
    > #### 세부정보 구성이 뭐길래 
    >     
    > AWS 서비스들의 네트워크 환경을 구성할 수 있음    
      -> 기업이나 대량의 서버라면 세세하게 다루지만, 혼자 1대의 서버만 쓸 1인 개발일 경우 패스
    
4. 스토리지 추가

    - 스토리지 = 서비의 디스크(저장공간) = **서버의 용량**    
    
    **기본값 8GB에서, 프리티어 최대치인 30GB**로 변경

5. 태그 추가

    - 태그 = 해당 인스턴스를 표현하는 여러 이름 (= 페북, 인스타의 태그와 같은 역할)
    태그로 인스턴스 뭉탱이를 구분하면, 검색하거나 그룹묶기 편리
    
    - 웹 콘솔에서 표시될 태그 = **Name** 태그 -> 키로 등록
    - 본인 서비스의 인스턴스를 나타내는 내용 -> 값으로 등록
    
6. 보안 그룹 구성

    - 보안 그룹 = 방화벽 **(보안 그룹 기본값 : 80포트 외에는 허용 안함)**  
      
    (기존 보안 그룹을 만든게 없으니) 새 보안 그룹 생성 -> 보안 그룹 이름과 설명을 의미있는 내용으로 변경
    
    **보안그룹 부분이 매우 중요함** : pem키만 믿고, ip를 전체 오픈(0.0.0.0/0, ::/0)하다가, pem키가 노출되는 순간 난리남...  
    보안은 다다익선 : **pem키 관리 + 지정된 ip에서만 ssh 접속 가능**하게 구성하는 것이 안전
    
    유형=ssh, 포트범위=22 인 경우 -> **AWS EC2에 터미널로 접속**할 때  
    -> 본인집 ip를 기본적으로 추가(**'내 ip'선택시 현재 접속한 장소 ip**가 추가) + 다른 장소에서 접속시 **해당 장소 ip를 ssh 규칙에 추가**
    
    그리고 현재 프로젝트 기본 포트(책에선 8080, 나는 8000)를 추가  
    -> 소스를 '0.0.0.0/0, ::/0'으로 모두 열어놓는 거는 검토 화면에서 보안 그룹 경고가 뜨지만, 8000열어 두는건 위험한게 아니니 무시
    
7. 검토 및 시작

    보안 개선은 위의 말처럼 무시해주고, **[시작하기]** 버튼 클릭 
    
    그러면, **'기존 키 페이 선택또는 새 키 페어 생성'** 이란 창이 뜬다.  
    인스턴스를 접근하려면 **pem 키(비밀키)** 가 필요하다.  
    -> 그래서 인스턴스 생성 마지막 단계가 할당할 pem키를 선택하는 것이다
    
    기존 생성된 pem키가 있으면 선택하고, 없으면 신규로 생성한다. (키 페어 이름은 의미있는 걸로 넣어주자)
    
    > #### pem키의 중요도
    >
    > 인스턴스는 지정된 **pem키(비밀키)** 와 매칭되는 공개키를 가짐 -> 해당 pem키 외에는 접근을 허용 안함  
      일종의 **마스터 키라서 절대 유출되거나 잃어버리면 안된다. (이후 EC2 서버로 접속할 때 필수 파일)** 
      잘 관리할 수 있는 디렉토리에 저장하도록 하자. 

    pem키도 잘 다운받았으면, **[인스턴스 시작]** 버튼을 클릭 -> 인스턴스 생성 페이지로 이동  
    *'지금 인스턴스를 시작 중입니다'* 라는 박스에서, '인스턴스 ID'를 클릭 -> EC2 목록으로 이동  
    인스턴스가 생성 중이며, 생성이 완료 됬으면 '인스턴스 ID'를 클릭 -> IP와 도메인이 잘 할당된 걸 확인하면 된다.
